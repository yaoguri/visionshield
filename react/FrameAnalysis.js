/*! For license information please see FrameAnalysis.js.LICENSE.txt */
var FrameAnalysis;(()=>{"use strict";var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{t.r(e),t.d(e,{default:()=>f});const r=React;var n=t.n(r);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,a,o,i,l=[],c=!0,u=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(l.push(n.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return l}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function l(){l=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function f(e,r,n,a){var o=r&&r.prototype instanceof m?r:m,i=Object.create(o.prototype);return s(i,"_invoke",function(e,r,n){var a=1;return function(o,i){if(3===a)throw Error("Generator is already running");if(4===a){if("throw"===o)throw i;return{value:t,done:!0}}for(n.method=o,n.arg=i;;){var l=n.delegate;if(l){var c=N(l,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===a)throw a=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=3;var u=h(e,r,n);if("normal"===u.type){if(a=n.done?4:2,u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=4,n.method="throw",n.arg=u.arg)}}}(e,n,new _(a||[])),!0),i}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var d={};function m(){}function p(){}function v(){}var y={};s(y,i,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(j([])));b&&b!==r&&n.call(b,i)&&(y=b);var w=v.prototype=m.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(o,i,l,c){var u=h(t[o],t,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==a(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,l,c)}),(function(t){r("throw",t,l,c)})):e.resolve(f).then((function(t){s.value=t,l(s)}),(function(t){return r("throw",t,l,c)}))}c(u.arg)}var o;s(this,"_invoke",(function(t,n){function a(){return new e((function(e,a){r(t,n,e,a)}))}return o=o?o.then(a,a):a()}),!0)}function N(e,r){var n=r.method,a=e.i[n];if(a===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var o=h(a,e.i,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,d;var i=o.arg;return i?i.done?(r[e.r]=i.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function S(t){this.tryEntries.push(t)}function k(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function _(t){this.tryEntries=[[-1]],t.forEach(S,this),this.reset(!0)}function j(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,l=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return l.next=l}}throw new TypeError(a(e)+" is not iterable")}return p.prototype=v,s(w,"constructor",v),s(v,"constructor",p),p.displayName=s(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,u,"GeneratorFunction")),t.prototype=Object.create(w),t},e.awrap=function(t){return{__await:t}},x(E.prototype),s(E.prototype,c,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new E(f(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},x(w),s(w,u,"Generator"),s(w,i,(function(){return this})),s(w,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=j,_.prototype={constructor:_,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){i.type="throw",i.arg=e,r.next=t}for(var a=r.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o[4],l=this.prev,c=o[1],u=o[2];if(-1===o[0])return n("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=l){if(l<c)return this.method="next",this.arg=t,n(c),!0;if(l<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var a=n;break}}a&&("break"===t||"continue"===t)&&a[0]<=e&&e<=a[2]&&(a=null);var o=a?a[4]:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a[2],d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),k(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var a=n.arg;k(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:j(e),r,n},"next"===this.method&&(this.arg=t),d}},e}function c(t,e,r,n,a,o,i){try{var l=t[o](i),c=l.value}catch(t){return void r(t)}l.done?e(c):Promise.resolve(c).then(n,a)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){c(o,n,a,i,l,"next",t)}function l(t){c(o,n,a,i,l,"throw",t)}i(void 0)}))}}var s=function(t){return u(l().mark((function e(){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/frame-analysis/".concat(t));case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 9:throw e.prev=9,e.t0=e.catch(0),console.error("Frame Analysis Error:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()};const f=function(t){var e,a,i,c,f=t.videoId,h=o((0,r.useState)([]),2),d=h[0],m=h[1],p=o((0,r.useState)(0),2),v=p[0],y=p[1],g=o((0,r.useState)(!1),2),b=g[0],w=g[1],x=o((0,r.useState)(!1),2),E=x[0],N=x[1],S=o((0,r.useState)(!0),2),k=S[0],_=S[1],j=o((0,r.useState)(null),2),O=j[0],A=j[1],F=(0,r.useRef)(null),M=(0,r.useRef)(null),P=(0,r.useRef)(null);(0,r.useEffect)((function(){function t(){return(t=u(l().mark((function t(){var e;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,_(!0),t.next=4,s(f);case 4:"success"===(e=t.sent).status?(m(e.frames),_(!1)):(A("Failed to load frame analysis data"),_(!1)),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),A("Error loading frame data: ".concat(t.t0.message)),_(!1);case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))).apply(this,arguments)}f&&function(){t.apply(this,arguments)}()}),[f]),(0,r.useEffect)((function(){if(F.current&&E&&0!==d.length){var t=F.current.duration;d.forEach((function(e,r){e.timestamp=t/d.length*r}))}}),[E,d]),(0,r.useEffect)((function(){var t=F.current;if(t&&E&&0!==d.length){var e=function(){var r=t.currentTime,n=d.findIndex((function(t,e){return r>=t.timestamp&&(e===d.length-1||r<d[e+1].timestamp)}));-1!==n&&(y(n),T(n)),b&&(P.current=requestAnimationFrame(e))};return b?(t.play(),P.current=requestAnimationFrame(e)):(t.pause(),P.current&&cancelAnimationFrame(P.current)),function(){P.current&&cancelAnimationFrame(P.current)}}}),[b,E,d]);var T=function(t){if(M.current&&d[t]){var e=M.current,r=e.getContext("2d"),n=F.current;e.width=n.videoWidth,e.height=n.videoHeight,r.clearRect(0,0,e.width,e.height);var a=d[t].probability_fake;if(a>.4){var o=Math.min(a,.7);r.drawImage(n,0,0,e.width,e.height),r.fillStyle="rgba(255, 0, 0, ".concat(o,")");var i=e.width*(.3+.4*Math.random()),l=e.height*(.2+.6*Math.random()),c=e.width*(.1+.2*a),u=e.height*(.1+.2*a);r.beginPath(),r.ellipse(i,l,c,u,0,0,2*Math.PI),r.fill(),r.fillStyle="rgba(255, 255, 255, 0.8)",r.font="bold 16px Arial",r.fillText("Manipulation Probability: ".concat((100*a).toFixed(1),"%"),20,30)}else r.drawImage(n,0,0,e.width,e.height)}},I=function(t){if(F.current&&0!==d.length){var e=d[t].timestamp;F.current.currentTime=e,y(t),T(t)}},R=function(t){var e=Math.floor(t/60),r=Math.floor(t%60);return"".concat(e,":").concat(r.toString().padStart(2,"0"))};return k?n().createElement("div",{className:"flex items-center justify-center h-64 bg-gray-100 rounded-lg"},n().createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})):O?n().createElement("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg"},n().createElement("p",null,O)):n().createElement("div",{className:"bg-white rounded-lg shadow-md overflow-hidden"},n().createElement("div",{className:"p-4 border-b"},n().createElement("h3",{className:"text-lg font-semibold text-gray-700"},"Frame-by-Frame Analysis"),n().createElement("p",{className:"text-sm text-gray-500"},"Explore how each frame of the video is analyzed for manipulation")),n().createElement("div",{className:"relative bg-black"},n().createElement("video",{ref:F,src:"/api/video/".concat(f),className:"w-full",onLoadedMetadata:function(){return N(!0)},onEnded:function(){return w(!1)}}),n().createElement("canvas",{ref:M,className:"absolute top-0 left-0 w-full h-full"}),n().createElement("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-3 flex items-center"},n().createElement("button",{className:"mr-3 h-8 w-8 flex items-center justify-center rounded-full bg-white text-black hover:bg-gray-200",onClick:function(){return w(!b)}},b?n().createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},n().createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})):n().createElement("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},n().createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"}))),n().createElement("div",{className:"text-sm font-medium mr-2"},E&&d[v]?R((null===(e=F.current)||void 0===e?void 0:e.currentTime)||0):"0:00"),n().createElement("div",{className:"flex-1 mx-2"},n().createElement("div",{className:"h-2 bg-gray-700 rounded relative"},d.map((function(t,e){var r;return n().createElement("div",{key:e,className:"absolute h-2 w-1 rounded cursor-pointer ".concat(t.probability_fake>.6?"bg-red-500":t.probability_fake>.4?"bg-yellow-500":"bg-green-500"),style:{left:"".concat(t.timestamp/((null===(r=F.current)||void 0===r?void 0:r.duration)||1)*100,"%")},onClick:function(){return I(e)}})})),n().createElement("div",{className:"absolute h-3 w-3 bg-white rounded-full top-1/2 transform -translate-y-1/2",style:{left:"".concat(E?F.current.currentTime/F.current.duration*100:0,"%")}}))),n().createElement("div",{className:"text-sm font-medium ml-2"},E?R((null===(a=F.current)||void 0===a?void 0:a.duration)||0):"0:00"))),n().createElement("div",{className:"p-4"},n().createElement("div",{className:"flex justify-between mb-3"},n().createElement("div",null,n().createElement("span",{className:"text-sm font-medium text-gray-500"},"Current Frame:"),n().createElement("span",{className:"ml-2 text-sm font-bold"},v+1,"/",d.length)),n().createElement("div",null,n().createElement("span",{className:"text-sm font-medium text-gray-500"},"Manipulation Probability:"),n().createElement("span",{className:"ml-2 text-sm font-bold ".concat((null===(i=d[v])||void 0===i?void 0:i.probability_fake)>.6?"text-red-500":(null===(c=d[v])||void 0===c?void 0:c.probability_fake)>.4?"text-yellow-500":"text-green-500")},d[v]?"".concat((100*d[v].probability_fake).toFixed(1),"%"):"0%"))),n().createElement("div",{className:"mt-4 overflow-x-auto whitespace-nowrap pb-2"},n().createElement("div",{className:"inline-flex space-x-2"},d.map((function(t,e){return n().createElement("div",{key:e,className:"w-16 h-10 relative rounded overflow-hidden cursor-pointer border-2 ".concat(v===e?"border-purple-600":"border-transparent"),onClick:function(){return I(e)}},n().createElement("div",{className:"absolute inset-0 bg-black opacity-0 hover:opacity-20 transition-opacity"}),n().createElement("div",{className:"absolute top-0 right-0 w-full h-1 ".concat(t.probability_fake>.6?"bg-red-500":t.probability_fake>.4?"bg-yellow-500":"bg-green-500")}),n().createElement("div",{className:"text-xs font-bold text-white absolute bottom-0 right-0 bg-black bg-opacity-50 px-1"},e+1))}))))))}})(),FrameAnalysis=e})();